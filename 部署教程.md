# å‘å¡ç½‘ç³»ç»Ÿ - è¯¦ç»†éƒ¨ç½²æ•™ç¨‹

æœ¬æ•™ç¨‹å°†æ‰‹æŠŠæ‰‹æ•™ä½ å¦‚ä½•åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²å‘å¡ç½‘ç³»ç»Ÿï¼Œé€‚åˆé›¶åŸºç¡€çš„æ–°æ‰‹ã€‚

## ç›®å½•

- [å‡†å¤‡å·¥ä½œ](#å‡†å¤‡å·¥ä½œ)
- [ç¬¬ä¸€éƒ¨åˆ†ï¼šè´­ä¹°å’Œé…ç½®æœåŠ¡å™¨](#ç¬¬ä¸€éƒ¨åˆ†è´­ä¹°å’Œé…ç½®æœåŠ¡å™¨)
- [ç¬¬äºŒéƒ¨åˆ†ï¼šå®‰è£… Docker ç¯å¢ƒ](#ç¬¬äºŒéƒ¨åˆ†å®‰è£…-docker-ç¯å¢ƒ)
- [ç¬¬ä¸‰éƒ¨åˆ†ï¼šä¸Šä¼ é¡¹ç›®ä»£ç ](#ç¬¬ä¸‰éƒ¨åˆ†ä¸Šä¼ é¡¹ç›®ä»£ç )
- [ç¬¬å››éƒ¨åˆ†ï¼šé…ç½®å’Œéƒ¨ç½²](#ç¬¬å››éƒ¨åˆ†é…ç½®å’Œéƒ¨ç½²)
- [ç¬¬äº”éƒ¨åˆ†ï¼šé…ç½®åŸŸåå’Œ HTTPS](#ç¬¬äº”éƒ¨åˆ†é…ç½®åŸŸåå’Œ-https)
- [ç¬¬å…­éƒ¨åˆ†ï¼šé…ç½®æ”¯ä»˜æ¥å£](#ç¬¬å…­éƒ¨åˆ†é…ç½®æ”¯ä»˜æ¥å£)
- [ç¬¬ä¸ƒéƒ¨åˆ†ï¼šæ—¥å¸¸ç»´æŠ¤](#ç¬¬ä¸ƒéƒ¨åˆ†æ—¥å¸¸ç»´æŠ¤)
- [å¸¸è§é—®é¢˜è§£ç­”](#å¸¸è§é—®é¢˜è§£ç­”)

---

## å‡†å¤‡å·¥ä½œ

### éœ€è¦å‡†å¤‡çš„ä¸œè¥¿

1. **æœåŠ¡å™¨**
   - æ¨èé…ç½®ï¼š2æ ¸CPU + 4GBå†…å­˜ + 40GBç¡¬ç›˜
   - ç³»ç»Ÿï¼šUbuntu 20.04 / CentOS 7+ / Debian 10+
   - äº‘æœåŠ¡å•†ï¼šé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€AWSã€Vultr ç­‰

2. **åŸŸå**ï¼ˆå¯é€‰ï¼Œä½†å¼ºçƒˆæ¨èï¼‰
   - ç”¨äºè®¿é—®ç½‘ç«™
   - éœ€è¦å¤‡æ¡ˆï¼ˆå›½å†…æœåŠ¡å™¨ï¼‰

3. **æ”¯ä»˜æ¥å£**ï¼ˆå¯é€‰ï¼‰
   - æ˜“æ”¯ä»˜è´¦å·
   - æˆ–æ”¯ä»˜å®/å¾®ä¿¡å®˜æ–¹æ¥å£

4. **SSH å·¥å…·**
   - Windows: PuTTYã€Xshellã€MobaXterm
   - Mac/Linux: è‡ªå¸¦ç»ˆç«¯

### é¢„è®¡æ—¶é—´

- é¦–æ¬¡éƒ¨ç½²ï¼š30-60 åˆ†é’Ÿ
- ç†Ÿç»ƒåï¼š10-15 åˆ†é’Ÿ

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šè´­ä¹°å’Œé…ç½®æœåŠ¡å™¨

### 1.1 è´­ä¹°æœåŠ¡å™¨

ä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ï¼ˆå…¶ä»–äº‘æœåŠ¡å•†ç±»ä¼¼ï¼‰ï¼š

1. è®¿é—® [é˜¿é‡Œäº‘å®˜ç½‘](https://www.aliyun.com/)
2. é€‰æ‹©"äº‘æœåŠ¡å™¨ ECS"
3. é€‰æ‹©é…ç½®ï¼š
   - **åœ°åŸŸ**ï¼šé€‰æ‹©ç¦»ä½ ç”¨æˆ·æœ€è¿‘çš„
   - **å®ä¾‹è§„æ ¼**ï¼š2æ ¸4GBï¼ˆå…¥é—¨é…ç½®ï¼‰
   - **é•œåƒ**ï¼šUbuntu 20.04 64ä½
   - **å­˜å‚¨**ï¼š40GB ç³»ç»Ÿç›˜
   - **ç½‘ç»œ**ï¼šæŒ‰ä½¿ç”¨æµé‡è®¡è´¹ï¼ˆæˆ–å›ºå®šå¸¦å®½ï¼‰
   - **å®‰å…¨ç»„**ï¼šå‹¾é€‰ HTTP(80) å’Œ HTTPS(443)

4. è®¾ç½®å¯†ç ï¼ˆè®°ä½è¿™ä¸ªå¯†ç ï¼Œåé¢è¦ç”¨ï¼‰
5. ç¡®è®¤è®¢å•å¹¶æ”¯ä»˜

### 1.2 é…ç½®å®‰å…¨ç»„

è´­ä¹°åï¼Œéœ€è¦å¼€æ”¾ç«¯å£ï¼š

1. è¿›å…¥ ECS æ§åˆ¶å°
2. æ‰¾åˆ°ä½ çš„æœåŠ¡å™¨å®ä¾‹
3. ç‚¹å‡»"å®‰å…¨ç»„é…ç½®"
4. æ·»åŠ ä»¥ä¸‹è§„åˆ™ï¼š

| ç«¯å£èŒƒå›´ | æˆæƒå¯¹è±¡ | è¯´æ˜ |
|---------|---------|------|
| 22 | 0.0.0.0/0 | SSH ç™»å½• |
| 80 | 0.0.0.0/0 | HTTP è®¿é—® |
| 443 | 0.0.0.0/0 | HTTPS è®¿é—® |

### 1.3 è·å–æœåŠ¡å™¨ IP

åœ¨ ECS æ§åˆ¶å°å¯ä»¥çœ‹åˆ°ä½ çš„æœåŠ¡å™¨å…¬ç½‘ IPï¼Œè®°ä¸‹æ¥ï¼Œä¾‹å¦‚ï¼š`123.456.789.10`

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šå®‰è£… Docker ç¯å¢ƒ

### 2.1 è¿æ¥åˆ°æœåŠ¡å™¨

**Windows ç”¨æˆ·ï¼ˆä½¿ç”¨ PuTTYï¼‰ï¼š**

1. ä¸‹è½½ PuTTYï¼šhttps://www.putty.org/
2. æ‰“å¼€ PuTTY
3. åœ¨ "Host Name" è¾“å…¥ä½ çš„æœåŠ¡å™¨ IP
4. ç«¯å£å¡« 22
5. ç‚¹å‡» "Open"
6. è¾“å…¥ç”¨æˆ·åï¼š`root`
7. è¾“å…¥å¯†ç ï¼ˆè´­ä¹°æœåŠ¡å™¨æ—¶è®¾ç½®çš„ï¼‰

**Mac/Linux ç”¨æˆ·ï¼š**

æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ï¼š
```bash
ssh root@ä½ çš„æœåŠ¡å™¨IP
# ä¾‹å¦‚ï¼šssh root@123.456.789.10
```

è¾“å…¥å¯†ç åå›è½¦ã€‚

### 2.2 æ›´æ–°ç³»ç»Ÿ

è¿æ¥æˆåŠŸåï¼Œå…ˆæ›´æ–°ç³»ç»Ÿï¼š

**Ubuntu/Debian:**
```bash
apt update && apt upgrade -y
```

**CentOS:**
```bash
yum update -y
```

### 2.3 å®‰è£… Docker

**æ–¹å¼ä¸€ï¼šä½¿ç”¨å®˜æ–¹è„šæœ¬ï¼ˆæ¨èï¼‰**

```bash
# ä¸‹è½½å¹¶æ‰§è¡Œ Docker å®‰è£…è„šæœ¬
curl -fsSL https://get.docker.com | sh

# å¯åŠ¨ Docker
systemctl start docker

# è®¾ç½®å¼€æœºè‡ªå¯
systemctl enable docker

# éªŒè¯å®‰è£…
docker --version
```

çœ‹åˆ°ç±»ä¼¼ `Docker version 24.0.7` çš„è¾“å‡ºå°±è¯´æ˜å®‰è£…æˆåŠŸäº†ã€‚

**æ–¹å¼äºŒï¼šæ‰‹åŠ¨å®‰è£…ï¼ˆUbuntuï¼‰**

```bash
# å®‰è£…ä¾èµ–
apt install -y apt-transport-https ca-certificates curl software-properties-common

# æ·»åŠ  Docker å®˜æ–¹ GPG å¯†é’¥
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add -

# æ·»åŠ  Docker ä»“åº“
add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"

# å®‰è£… Docker
apt update
apt install -y docker-ce docker-ce-cli containerd.io

# å¯åŠ¨ Docker
systemctl start docker
systemctl enable docker
```

### 2.4 å®‰è£… Docker Compose

```bash
# ä¸‹è½½ Docker Compose
curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose

# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x /usr/local/bin/docker-compose

# éªŒè¯å®‰è£…
docker-compose --version
```

çœ‹åˆ°ç±»ä¼¼ `Docker Compose version v2.23.0` çš„è¾“å‡ºå°±è¯´æ˜å®‰è£…æˆåŠŸäº†ã€‚

**å¦‚æœä¸‹è½½é€Ÿåº¦æ…¢ï¼Œå¯ä»¥ä½¿ç”¨å›½å†…é•œåƒï¼š**

```bash
# ä½¿ç”¨ DaoCloud é•œåƒ
curl -L https://get.daocloud.io/docker/compose/releases/download/v2.23.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
```

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šä¸Šä¼ é¡¹ç›®ä»£ç 

### 3.1 æ–¹å¼ä¸€ï¼šä½¿ç”¨ Gitï¼ˆæ¨èï¼‰

å¦‚æœä½ çš„ä»£ç åœ¨ GitHub/Gitee ä¸Šï¼š

```bash
# å®‰è£… Git
apt install -y git  # Ubuntu/Debian
# æˆ–
yum install -y git  # CentOS

# å…‹éš†é¡¹ç›®
cd /root
git clone https://github.com/your-username/card-shop-system.git
cd card-shop-system
```

### 3.2 æ–¹å¼äºŒï¼šä½¿ç”¨ SFTP ä¸Šä¼ 

**ä½¿ç”¨ FileZillaï¼š**

1. ä¸‹è½½ FileZillaï¼šhttps://filezilla-project.org/
2. æ‰“å¼€ FileZilla
3. å¡«å†™è¿æ¥ä¿¡æ¯ï¼š
   - ä¸»æœºï¼š`sftp://ä½ çš„æœåŠ¡å™¨IP`
   - ç”¨æˆ·åï¼š`root`
   - å¯†ç ï¼šä½ çš„æœåŠ¡å™¨å¯†ç 
   - ç«¯å£ï¼š`22`
4. ç‚¹å‡»"å¿«é€Ÿè¿æ¥"
5. å°†æœ¬åœ°çš„é¡¹ç›®æ–‡ä»¶å¤¹æ‹–åˆ°å³ä¾§ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰çš„ `/root/` ç›®å½•

**ä½¿ç”¨ WinSCPï¼ˆWindowsï¼‰ï¼š**

1. ä¸‹è½½ WinSCPï¼šhttps://winscp.net/
2. æ–°å»ºç«™ç‚¹ï¼Œå¡«å†™æœåŠ¡å™¨ä¿¡æ¯
3. è¿æ¥åä¸Šä¼ é¡¹ç›®æ–‡ä»¶å¤¹

### 3.3 æ–¹å¼ä¸‰ï¼šä½¿ç”¨ scp å‘½ä»¤ï¼ˆMac/Linuxï¼‰

åœ¨æœ¬åœ°ç”µè„‘ä¸Šæ‰§è¡Œï¼š

```bash
# å‹ç¼©é¡¹ç›®
tar -czf card-shop.tar.gz card-shop-system/

# ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp card-shop.tar.gz root@ä½ çš„æœåŠ¡å™¨IP:/root/

# è¿æ¥åˆ°æœåŠ¡å™¨
ssh root@ä½ çš„æœåŠ¡å™¨IP

# è§£å‹
cd /root
tar -xzf card-shop.tar.gz
cd card-shop-system
```

---

## ç¬¬å››éƒ¨åˆ†ï¼šé…ç½®å’Œéƒ¨ç½²

### 4.1 é…ç½®ç¯å¢ƒå˜é‡

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /root/card-shop-system

# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.docker .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
nano .env
```

**nano ç¼–è¾‘å™¨ä½¿ç”¨è¯´æ˜ï¼š**
- ä½¿ç”¨æ–¹å‘é”®ç§»åŠ¨å…‰æ ‡
- ä¿®æ”¹å†…å®¹
- æŒ‰ `Ctrl + O` ä¿å­˜
- æŒ‰ `Enter` ç¡®è®¤
- æŒ‰ `Ctrl + X` é€€å‡º

**å¿…é¡»ä¿®æ”¹çš„é…ç½®ï¼š**

```env
# æ•°æ®åº“å¯†ç ï¼ˆæ”¹æˆä½ è‡ªå·±çš„å¼ºå¯†ç ï¼‰
DB_PASSWORD=YourSecurePassword123!

# JWT å¯†é’¥ï¼ˆæ”¹æˆéšæœºå­—ç¬¦ä¸²ï¼Œè¶Šé•¿è¶Šå®‰å…¨ï¼‰
JWT_SECRET=your_random_secret_key_change_this_to_something_secure_123456

# å¦‚æœæœ‰åŸŸåï¼Œä¿®æ”¹è¿™ä¸¤é¡¹
API_URL=http://your-domain.com
CLIENT_URL=http://your-domain.com
```

**å¯é€‰é…ç½®ï¼ˆåé¢å¯ä»¥å†æ”¹ï¼‰ï¼š**

```env
# æ˜“æ”¯ä»˜é…ç½®ï¼ˆç”³è¯·åå¡«å†™ï¼‰
EPAY_API_URL=https://pay.example.com
EPAY_PID=your_pid
EPAY_KEY=your_key

# åˆ†é”€æ¯”ä¾‹ï¼ˆé»˜è®¤ä¸€çº§10%ï¼ŒäºŒçº§5%ï¼‰
LEVEL1_COMMISSION_RATE=0.10
LEVEL2_COMMISSION_RATE=0.05

# æœ€ä½æç°é‡‘é¢ï¼ˆé»˜è®¤10å…ƒï¼‰
MIN_WITHDRAWAL=10.00
```

ä¿å­˜å¹¶é€€å‡ºã€‚

### 4.2 ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™

```bash
chmod +x deploy.sh
chmod +x docker-entrypoint.sh
```

### 4.3 å¼€å§‹éƒ¨ç½²

```bash
./deploy.sh
```

ä¼šå‡ºç°èœå•ï¼Œé€‰æ‹© `1` (é¦–æ¬¡éƒ¨ç½²)ï¼Œç„¶åå›è½¦ã€‚

**éƒ¨ç½²è¿‡ç¨‹ï¼š**

```
è¯·é€‰æ‹©æ“ä½œ:
1) é¦–æ¬¡éƒ¨ç½²ï¼ˆæ„å»ºå¹¶å¯åŠ¨ï¼‰
2) å¯åŠ¨æœåŠ¡
3) åœæ­¢æœåŠ¡
4) é‡å¯æœåŠ¡
5) æŸ¥çœ‹æ—¥å¿—
6) æŸ¥çœ‹çŠ¶æ€
7) æ¸…ç†å¹¶é‡æ–°éƒ¨ç½²
8) å¤‡ä»½æ•°æ®åº“
9) é€€å‡º

è¯·è¾“å…¥é€‰é¡¹ [1-9]: 1
```

è¾“å…¥ `1` åå›è½¦ï¼Œç­‰å¾…éƒ¨ç½²å®Œæˆã€‚

**éƒ¨ç½²è¿‡ç¨‹ä¼šæ˜¾ç¤ºï¼š**

```
å¼€å§‹é¦–æ¬¡éƒ¨ç½²...
[+] Building 45.2s (18/18) FINISHED
[+] Running 4/4
 âœ” Network card-shop-network    Created
 âœ” Container card-shop-mysql    Started
 âœ” Container card-shop-app      Started
 âœ” Container card-shop-nginx    Started

éƒ¨ç½²å®Œæˆï¼
è®¿é—®åœ°å€: http://localhost
ç®¡ç†åå°: http://localhost/admin
é»˜è®¤è´¦å·: admin / admin123
```

çœ‹åˆ°è¿™ä¸ªå°±è¯´æ˜éƒ¨ç½²æˆåŠŸäº†ï¼

### 4.4 éªŒè¯éƒ¨ç½²

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps
```

åº”è¯¥çœ‹åˆ°ä¸‰ä¸ªæœåŠ¡éƒ½æ˜¯ `Up` çŠ¶æ€ï¼š

```
NAME                 STATUS
card-shop-mysql      Up (healthy)
card-shop-app        Up (healthy)
card-shop-nginx      Up
```

### 4.5 æŸ¥çœ‹æ—¥å¿—

å¦‚æœæœ‰é—®é¢˜ï¼Œå¯ä»¥æŸ¥çœ‹æ—¥å¿—ï¼š

```bash
# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
docker-compose logs

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker-compose logs app

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker-compose logs mysql

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

---

## ç¬¬äº”éƒ¨åˆ†ï¼šé…ç½®åŸŸåå’Œ HTTPS

### 5.1 é…ç½®åŸŸåè§£æ

1. ç™»å½•ä½ çš„åŸŸåæœåŠ¡å•†ï¼ˆé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰ï¼‰
2. è¿›å…¥åŸŸåç®¡ç†
3. æ·»åŠ  A è®°å½•ï¼š
   - ä¸»æœºè®°å½•ï¼š`@` æˆ– `www`
   - è®°å½•ç±»å‹ï¼š`A`
   - è®°å½•å€¼ï¼šä½ çš„æœåŠ¡å™¨ IP
   - TTLï¼š`10åˆ†é’Ÿ`

4. ç­‰å¾… DNS ç”Ÿæ•ˆï¼ˆé€šå¸¸ 5-10 åˆ†é’Ÿï¼‰

5. æµ‹è¯•åŸŸåæ˜¯å¦ç”Ÿæ•ˆï¼š
```bash
ping your-domain.com
```

### 5.2 ç”³è¯· SSL è¯ä¹¦

**æ–¹å¼ä¸€ï¼šä½¿ç”¨ Let's Encrypt å…è´¹è¯ä¹¦ï¼ˆæ¨èï¼‰**

```bash
# å®‰è£… certbot
apt install -y certbot  # Ubuntu/Debian
# æˆ–
yum install -y certbot  # CentOS

# åœæ­¢ Nginxï¼ˆä¸´æ—¶ï¼‰
docker-compose stop nginx

# ç”³è¯·è¯ä¹¦
certbot certonly --standalone -d your-domain.com -d www.your-domain.com

# æŒ‰æç¤ºè¾“å…¥é‚®ç®±
# åŒæ„æœåŠ¡æ¡æ¬¾
```

è¯ä¹¦ä¼šä¿å­˜åœ¨ï¼š`/etc/letsencrypt/live/your-domain.com/`

**æ–¹å¼äºŒï¼šä½¿ç”¨äº‘æœåŠ¡å•†å…è´¹è¯ä¹¦**

1. åœ¨é˜¿é‡Œäº‘/è…¾è®¯äº‘ç”³è¯·å…è´¹ SSL è¯ä¹¦
2. ä¸‹è½½ Nginx æ ¼å¼çš„è¯ä¹¦
3. è§£å‹å¾—åˆ°ä¸¤ä¸ªæ–‡ä»¶ï¼š
   - `cert.pem` (è¯ä¹¦æ–‡ä»¶)
   - `key.pem` (ç§é’¥æ–‡ä»¶)

### 5.3 é…ç½® HTTPS

```bash
# åˆ›å»º SSL ç›®å½•
mkdir -p nginx/ssl

# å¤åˆ¶è¯ä¹¦æ–‡ä»¶
# å¦‚æœä½¿ç”¨ Let's Encrypt:
cp /etc/letsencrypt/live/your-domain.com/fullchain.pem nginx/ssl/cert.pem
cp /etc/letsencrypt/live/your-domain.com/privkey.pem nginx/ssl/key.pem

# å¦‚æœä½¿ç”¨äº‘æœåŠ¡å•†è¯ä¹¦ï¼Œä¸Šä¼ åˆ° nginx/ssl/ ç›®å½•

# ä¿®æ”¹ Nginx é…ç½®
nano nginx/conf.d/default.conf
```

æ‰¾åˆ° HTTPS é…ç½®éƒ¨åˆ†ï¼ˆåœ¨æ–‡ä»¶æœ«å°¾ï¼‰ï¼Œå–æ¶ˆæ³¨é‡Šå¹¶ä¿®æ”¹ï¼š

```nginx
# å–æ¶ˆä¸‹é¢è¿™äº›è¡Œçš„æ³¨é‡Šï¼ˆåˆ é™¤å¼€å¤´çš„ #ï¼‰
server {
    listen 443 ssl http2;
    server_name your-domain.com www.your-domain.com;  # æ”¹æˆä½ çš„åŸŸå
    
    ssl_certificate /etc/nginx/ssl/cert.pem;
    ssl_certificate_key /etc/nginx/ssl/key.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;
    
    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /usr/share/nginx/html;
        try_files $uri $uri/ /index.html;
    }

    # API ä»£ç†
    location /api {
        proxy_pass http://app:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}

# HTTP è‡ªåŠ¨è·³è½¬åˆ° HTTPS
server {
    listen 80;
    server_name your-domain.com www.your-domain.com;  # æ”¹æˆä½ çš„åŸŸå
    return 301 https://$server_name$request_uri;
}
```

ä¿å­˜å¹¶é€€å‡ºã€‚

```bash
# é‡å¯ Nginx
docker-compose restart nginx

# æŸ¥çœ‹ Nginx æ—¥å¿—ç¡®è®¤æ²¡æœ‰é”™è¯¯
docker-compose logs nginx
```

### 5.4 æµ‹è¯• HTTPS

åœ¨æµè§ˆå™¨è®¿é—®ï¼š`https://your-domain.com`

åº”è¯¥å¯ä»¥çœ‹åˆ°å°é”å›¾æ ‡ï¼Œè¯´æ˜ HTTPS é…ç½®æˆåŠŸï¼

### 5.5 è‡ªåŠ¨ç»­æœŸè¯ä¹¦ï¼ˆLet's Encryptï¼‰

Let's Encrypt è¯ä¹¦æœ‰æ•ˆæœŸ 90 å¤©ï¼Œéœ€è¦å®šæœŸç»­æœŸï¼š

```bash
# æµ‹è¯•ç»­æœŸ
certbot renew --dry-run

# æ·»åŠ è‡ªåŠ¨ç»­æœŸä»»åŠ¡
crontab -e

# æ·»åŠ ä»¥ä¸‹è¡Œï¼ˆæ¯æœˆ1å·å‡Œæ™¨2ç‚¹è‡ªåŠ¨ç»­æœŸï¼‰
0 2 1 * * certbot renew --quiet && docker-compose restart nginx
```

---

## ç¬¬å…­éƒ¨åˆ†ï¼šé…ç½®æ”¯ä»˜æ¥å£

### 6.1 ç”³è¯·æ˜“æ”¯ä»˜æ¥å£

1. æ³¨å†Œæ˜“æ”¯ä»˜è´¦å·ï¼ˆæœç´¢"æ˜“æ”¯ä»˜"æ‰¾åˆ°æœåŠ¡å•†ï¼‰
2. å®åè®¤è¯
3. è·å–ä»¥ä¸‹ä¿¡æ¯ï¼š
   - API åœ°å€ï¼ˆä¾‹å¦‚ï¼š`https://pay.example.com`ï¼‰
   - å•†æˆ· IDï¼ˆPIDï¼‰
   - å•†æˆ·å¯†é’¥ï¼ˆKEYï¼‰

### 6.2 é…ç½®æ”¯ä»˜å‚æ•°

```bash
# ç¼–è¾‘ç¯å¢ƒå˜é‡
nano .env
```

ä¿®æ”¹æ”¯ä»˜é…ç½®ï¼š

```env
EPAY_API_URL=https://pay.example.com
EPAY_PID=10001
EPAY_KEY=your_epay_key_here
```

ä¿å­˜å¹¶é€€å‡ºã€‚

```bash
# é‡å¯åº”ç”¨
docker-compose restart app
```

### 6.3 æµ‹è¯•æ”¯ä»˜åŠŸèƒ½

1. è®¿é—®ç½‘ç«™å‰å°
2. æ³¨å†Œä¸€ä¸ªæµ‹è¯•è´¦å·
3. é€‰æ‹©å•†å“è´­ä¹°
4. é€‰æ‹©æ”¯ä»˜æ–¹å¼
5. è·³è½¬åˆ°æ”¯ä»˜é¡µé¢
6. ä½¿ç”¨æµ‹è¯•é‡‘é¢æ”¯ä»˜
7. æ”¯ä»˜æˆåŠŸåæŸ¥çœ‹è®¢å•

---

## ç¬¬ä¸ƒéƒ¨åˆ†ï¼šæ—¥å¸¸ç»´æŠ¤

### 7.1 æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡
docker-compose ps

# æŸ¥çœ‹èµ„æºä½¿ç”¨
docker stats
```

### 7.2 æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹æœ€è¿‘ 100 è¡Œæ—¥å¿—
docker-compose logs --tail=100

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs -f app
docker-compose logs -f mysql
docker-compose logs -f nginx
```

### 7.3 å¤‡ä»½æ•°æ®åº“

**æ–¹å¼ä¸€ï¼šä½¿ç”¨è„šæœ¬**

```bash
./deploy.sh
# é€‰æ‹© 8) å¤‡ä»½æ•°æ®åº“
```

**æ–¹å¼äºŒï¼šæ‰‹åŠ¨å¤‡ä»½**

```bash
# å¤‡ä»½æ•°æ®åº“
docker-compose exec mysql mysqldump -u root -p card_shop > backup_$(date +%Y%m%d).sql

# è¾“å…¥æ•°æ®åº“å¯†ç ï¼ˆ.env ä¸­çš„ DB_PASSWORDï¼‰
```

å¤‡ä»½æ–‡ä»¶ä¼šä¿å­˜åœ¨å½“å‰ç›®å½•ã€‚

**å®šæœŸè‡ªåŠ¨å¤‡ä»½ï¼š**

```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
nano /root/backup.sh
```

è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š

```bash
#!/bin/bash
cd /root/card-shop-system
docker-compose exec -T mysql mysqldump -u root -pYourPassword card_shop > /root/backups/backup_$(date +%Y%m%d_%H%M%S).sql
# åˆ é™¤ 30 å¤©å‰çš„å¤‡ä»½
find /root/backups -name "backup_*.sql" -mtime +30 -delete
```

ä¿å­˜å¹¶æ·»åŠ æ‰§è¡Œæƒé™ï¼š

```bash
chmod +x /root/backup.sh

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p /root/backups

# æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤©å‡Œæ™¨ 3 ç‚¹å¤‡ä»½ï¼‰
crontab -e

# æ·»åŠ ä»¥ä¸‹è¡Œ
0 3 * * * /root/backup.sh
```

### 7.4 æ¢å¤æ•°æ®åº“

```bash
# æ¢å¤æ•°æ®åº“
docker-compose exec -T mysql mysql -u root -p card_shop < backup_20240101.sql

# è¾“å…¥æ•°æ®åº“å¯†ç 
```

### 7.5 æ›´æ–°ç³»ç»Ÿ

```bash
# 1. å¤‡ä»½æ•°æ®
./deploy.sh  # é€‰æ‹© 8

# 2. æ‹‰å–æœ€æ–°ä»£ç ï¼ˆå¦‚æœä½¿ç”¨ Gitï¼‰
git pull

# 3. é‡æ–°æ„å»º
docker-compose build --no-cache

# 4. é‡å¯æœåŠ¡
docker-compose up -d
```

### 7.6 ä¿®æ”¹ç®¡ç†å‘˜å¯†ç 

```bash
# è¿›å…¥ MySQL å®¹å™¨
docker-compose exec mysql mysql -u root -p

# è¾“å…¥æ•°æ®åº“å¯†ç åï¼Œæ‰§è¡Œï¼š
USE card_shop;

# ç”Ÿæˆæ–°å¯†ç çš„å“ˆå¸Œå€¼ï¼ˆåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼‰
docker-compose exec app node -e "console.log(require('bcryptjs').hashSync('æ–°å¯†ç ', 10))"

# å¤åˆ¶è¾“å‡ºçš„å“ˆå¸Œå€¼ï¼Œç„¶ååœ¨ MySQL ä¸­æ‰§è¡Œï¼š
UPDATE users SET password = 'å“ˆå¸Œå€¼' WHERE username = 'admin';

# é€€å‡º MySQL
exit;
```

### 7.7 ç›‘æ§æœåŠ¡å™¨èµ„æº

```bash
# æŸ¥çœ‹ CPU å’Œå†…å­˜ä½¿ç”¨
top

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# æŸ¥çœ‹ Docker ç£ç›˜ä½¿ç”¨
docker system df

# æ¸…ç†æ— ç”¨çš„ Docker æ•°æ®
docker system prune -a
```

---

## å¸¸è§é—®é¢˜è§£ç­”

### Q1: éƒ¨ç½²åæ— æ³•è®¿é—®ç½‘ç«™ï¼Ÿ

**æ£€æŸ¥æ­¥éª¤ï¼š**

1. æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼š
```bash
docker-compose ps
```

2. æ£€æŸ¥é˜²ç«å¢™ï¼š
```bash
# Ubuntu
ufw status
ufw allow 80/tcp
ufw allow 443/tcp

# CentOS
firewall-cmd --list-all
firewall-cmd --permanent --add-service=http
firewall-cmd --permanent --add-service=https
firewall-cmd --reload
```

3. æ£€æŸ¥äº‘æœåŠ¡å™¨å®‰å…¨ç»„æ˜¯å¦å¼€æ”¾ 80 å’Œ 443 ç«¯å£

4. æŸ¥çœ‹ Nginx æ—¥å¿—ï¼š
```bash
docker-compose logs nginx
```

### Q2: æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Ÿ

```bash
# æ£€æŸ¥ MySQL æ˜¯å¦è¿è¡Œ
docker-compose ps mysql

# æŸ¥çœ‹ MySQL æ—¥å¿—
docker-compose logs mysql

# æ£€æŸ¥ .env é…ç½®æ˜¯å¦æ­£ç¡®
cat .env | grep DB_

# è¿›å…¥ MySQL æµ‹è¯•è¿æ¥
docker-compose exec mysql mysql -u root -p
```

### Q3: æ”¯ä»˜å›è°ƒå¤±è´¥ï¼Ÿ

1. ç¡®ä¿æœåŠ¡å™¨å¯ä»¥è¢«å¤–ç½‘è®¿é—®
2. æ£€æŸ¥æ”¯ä»˜æ¥å£é…ç½®æ˜¯å¦æ­£ç¡®
3. æŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼š
```bash
docker-compose logs app | grep payment
```

### Q4: å¦‚ä½•æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼Ÿ

```bash
# åº”ç”¨é”™è¯¯æ—¥å¿—
docker-compose logs app | grep -i error

# Nginx é”™è¯¯æ—¥å¿—
docker-compose logs nginx | grep -i error

# æ•°æ®åº“é”™è¯¯æ—¥å¿—
docker-compose logs mysql | grep -i error
```

### Q5: æœåŠ¡å™¨é‡å¯åæœåŠ¡æ²¡æœ‰è‡ªåŠ¨å¯åŠ¨ï¼Ÿ

```bash
# è®¾ç½® Docker å¼€æœºè‡ªå¯
systemctl enable docker

# è®¾ç½®å®¹å™¨è‡ªåŠ¨é‡å¯ï¼ˆå·²åœ¨ docker-compose.yml ä¸­é…ç½®ï¼‰
# restart: always
```

### Q6: å¦‚ä½•ä¿®æ”¹ç«¯å£ï¼Ÿ

ç¼–è¾‘ `docker-compose.yml`ï¼š

```yaml
nginx:
  ports:
    - "8080:80"  # å°† 80 æ”¹ä¸º 8080
    - "8443:443" # å°† 443 æ”¹ä¸º 8443
```

ç„¶åé‡å¯ï¼š
```bash
docker-compose up -d
```

### Q7: å†…å­˜ä¸è¶³æ€ä¹ˆåŠï¼Ÿ

```bash
# æ·»åŠ  Swap äº¤æ¢ç©ºé—´
fallocate -l 2G /swapfile
chmod 600 /swapfile
mkswap /swapfile
swapon /swapfile

# æ°¸ä¹…ç”Ÿæ•ˆ
echo '/swapfile none swap sw 0 0' >> /etc/fstab
```

### Q8: å¦‚ä½•å‡çº§ Dockerï¼Ÿ

```bash
# Ubuntu/Debian
apt update
apt install --only-upgrade docker-ce

# CentOS
yum update docker-ce

# é‡å¯ Docker
systemctl restart docker

# é‡å¯å®¹å™¨
docker-compose up -d
```

### Q9: å¦‚ä½•è¿ç§»åˆ°æ–°æœåŠ¡å™¨ï¼Ÿ

```bash
# åœ¨æ—§æœåŠ¡å™¨ä¸Šï¼š
# 1. å¤‡ä»½æ•°æ®åº“
docker-compose exec mysql mysqldump -u root -p card_shop > backup.sql

# 2. æ‰“åŒ…é¡¹ç›®æ–‡ä»¶
tar -czf card-shop-backup.tar.gz card-shop-system/ backup.sql

# 3. ä¸‹è½½åˆ°æœ¬åœ°
scp root@æ—§æœåŠ¡å™¨IP:/root/card-shop-backup.tar.gz ./

# åœ¨æ–°æœåŠ¡å™¨ä¸Šï¼š
# 1. ä¸Šä¼ å¤‡ä»½æ–‡ä»¶
scp card-shop-backup.tar.gz root@æ–°æœåŠ¡å™¨IP:/root/

# 2. è§£å‹
tar -xzf card-shop-backup.tar.gz

# 3. æŒ‰ç…§æœ¬æ•™ç¨‹é‡æ–°éƒ¨ç½²
# 4. æ¢å¤æ•°æ®åº“
docker-compose exec -T mysql mysql -u root -p card_shop < backup.sql
```

### Q10: å¦‚ä½•æŸ¥çœ‹å®æ—¶è®¿é—®é‡ï¼Ÿ

```bash
# æŸ¥çœ‹ Nginx è®¿é—®æ—¥å¿—
docker-compose exec nginx tail -f /var/log/nginx/card-shop-access.log

# ç»Ÿè®¡ä»Šå¤©çš„è®¿é—®é‡
docker-compose exec nginx grep $(date +%d/%b/%Y) /var/log/nginx/card-shop-access.log | wc -l
```

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å¯ç”¨ Redis ç¼“å­˜

ç¼–è¾‘ `docker-compose.yml`ï¼Œæ·»åŠ  Redis æœåŠ¡ï¼š

```yaml
redis:
  image: redis:alpine
  container_name: card-shop-redis
  restart: always
  ports:
    - "6379:6379"
  networks:
    - card-shop-network
```

### 2. ä½¿ç”¨ CDN åŠ é€Ÿ

å°†é™æ€èµ„æºä¸Šä¼ åˆ° CDNï¼ˆé˜¿é‡Œäº‘ OSSã€è…¾è®¯äº‘ COS ç­‰ï¼‰

### 3. æ•°æ®åº“ä¼˜åŒ–

ç¼–è¾‘ `docker-compose.yml`ï¼Œè°ƒæ•´ MySQL é…ç½®ï¼š

```yaml
mysql:
  command: >
    --max_connections=1000
    --innodb_buffer_pool_size=1G
    --query_cache_size=64M
```

### 4. å¯ç”¨ Gzip å‹ç¼©

å·²åœ¨ `nginx/nginx.conf` ä¸­é…ç½®ï¼Œæ— éœ€é¢å¤–æ“ä½œã€‚

---

## å®‰å…¨åŠ å›º

### 1. ä¿®æ”¹ SSH ç«¯å£

```bash
nano /etc/ssh/sshd_config

# æ‰¾åˆ° #Port 22ï¼Œæ”¹ä¸ºï¼š
Port 2222

# é‡å¯ SSH
systemctl restart sshd
```

è®°å¾—åœ¨å®‰å…¨ç»„ä¸­å¼€æ”¾æ–°ç«¯å£ï¼

### 2. ç¦ç”¨ root ç™»å½•

```bash
# åˆ›å»ºæ–°ç”¨æˆ·
adduser admin
usermod -aG sudo admin

# ç¦ç”¨ root SSH ç™»å½•
nano /etc/ssh/sshd_config

# æ‰¾åˆ° PermitRootLogin yesï¼Œæ”¹ä¸ºï¼š
PermitRootLogin no

# é‡å¯ SSH
systemctl restart sshd
```

### 3. å®‰è£…é˜²ç«å¢™

```bash
# Ubuntu
apt install -y ufw
ufw allow 22/tcp
ufw allow 80/tcp
ufw allow 443/tcp
ufw enable

# CentOS
systemctl start firewalld
systemctl enable firewalld
firewall-cmd --permanent --add-service=ssh
firewall-cmd --permanent --add-service=http
firewall-cmd --permanent --add-service=https
firewall-cmd --reload
```

### 4. å®‰è£… Fail2banï¼ˆé˜²æš´åŠ›ç ´è§£ï¼‰

```bash
apt install -y fail2ban
systemctl start fail2ban
systemctl enable fail2ban
```

---

## æ€»ç»“

æ­å–œä½ å®Œæˆéƒ¨ç½²ï¼ç°åœ¨ä½ çš„å‘å¡ç½‘ç³»ç»Ÿå·²ç»å¯ä»¥æ­£å¸¸è¿è¡Œäº†ã€‚

**ä¸‹ä¸€æ­¥å»ºè®®ï¼š**

1. âœ… ä¿®æ”¹ç®¡ç†å‘˜å¯†ç 
2. âœ… é…ç½®æ”¯ä»˜æ¥å£
3. âœ… æ·»åŠ å•†å“å’Œå¡å¯†
4. âœ… æµ‹è¯•è´­ä¹°æµç¨‹
5. âœ… é…ç½® HTTPS
6. âœ… è®¾ç½®å®šæœŸå¤‡ä»½
7. âœ… ç›‘æ§æœåŠ¡å™¨èµ„æº

**éœ€è¦å¸®åŠ©ï¼Ÿ**

- æŸ¥çœ‹ [API æ–‡æ¡£](API.md)
- æŸ¥çœ‹ [é¡¹ç›®ç»“æ„](PROJECT_STRUCTURE.md)
- æäº¤ Issue è·å–æ”¯æŒ

---

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰
